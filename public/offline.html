<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
    <title>PixelsPlace - Offline</title>
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <style>
        /* Variáveis globais (consistência) */
        :root {
            /* Cores */
            --color-outline: hsla(0deg, 0%, 100%, 10%);
            --color-accent: hsl(207, 100%, 42%);
            --color-accent-hover: hsl(211, 100%, 36%);
            --color-experimental-accent: hsl(47, 100%, 42%);
            --color-experimental-accent-hover: hsl(47, 100%, 36%);
            --color-darker: hsl(217.99, 100%, 44.9%);
            --color-mid-hover: hsl(223, 29%, 31%);
            --color-mid: hsl(222, 26%, 22%);
            --color-input-bg: hsl(225, 36%, 17%);
            --color-darkest: hsl(222, 40%, 13%);
            --color-bg: var(--color-darkest);
            --color-muted: hsl(212, 100%, 75%);
            --color-text-dark: hsla(0, 0%, 25%, 75%);
            --color-text-light: hsla(0, 0%, 100%, 75%);
            --color-hover: rgb(228, 228, 228);
            --color-canvas-bg: hsl(0, 0%, 92%);
            --color-header: var(--color-muted);
            /* Degradês */
            --frosted-glass: linear-gradient(45deg, hsla(0deg, 0%, 96.08%, 96.86%), hsla(0deg, 0%, 100%, 90.98%));
            /* Atributos */
            --shadow: 2px 2px 7px hsla(0, 0%, 0%, 14.1%);
            --outline: 1px solid var(--color-outline);
            --smooth-transition: all .4s ease;
            /* Valores */
            --hover-scale: 1.05;
            --frosted-glass-blur: blur(5px);
        }

        /* Temas */
        [data-theme=TRUE_DARK] {
            --color-bg: radial-gradient(circle at 60% 100%, var(--color-darkest), #0a0d16);
            --color-canvas-bg: var(--color-bg);
            --color-text-dark: var(--color-text-light);
            --color-hover: hsl(0, 0%, 13%);
            --frosted-glass: linear-gradient(45deg, hsl(0deg 0% 16% / 50%), hsl(0deg 0% 18.29% / 81%));
        }

        [data-theme=LIGHT] {
            --color-outline: hsl(0deg 0% 0% / 12%);
            --color-mid-hover: hsl(0, 0%, 100%);
            --color-hover: hsl(0, 0%, 100%);
            --color-mid: hsl(0, 0%, 100%);
            --color-input-bg: hsl(0, 0%, 100%);
            --color-darkest: hsl(0deg 0% 100%);
            --color-muted: var(--color-accent);
            --color-canvas-bg: hsl(0, 0%, 100%);
            --color-text-light: var(--color-text-dark);
            --color-header: var(--frosted-glass);
            --color-bg: var(--color-darkest);
        }

        [data-theme=BLACKOUT] {
            --color-outline: hsla(0, 0%, 100%, 0.1);
            --color-mid-hover: hsl(0, 0%, 13%);
            --color-hover: hsl(0, 0%, 13%);
            --color-mid: hsl(0, 0%, 0%);
            --color-input-bg: hsl(0, 0%, 0%);
            --color-darkest: hsl(0, 0%, 0%);
            --color-canvas-bg: var(--color-bg);
            --color-text-dark: var(--color-text-light);
            --frosted-glass: linear-gradient(45deg, hsla(0deg, 0%, 4%, 96.86%), hsla(0deg, 0%, 0%, 90.98%));
            --color-header: var(--frosted-glass);
            --color-bg: var(--color-darkest);
        }

        [data-theme=OLD] {
            --color-header: #7f99cb;
            --color-darkest: #293146;
            --color-mid: #141c2f;
            --color-muted: #9dcaff;
            --color-accent: #0075d5;
            --color-accent-hover: #0054e5;
            --frosted-glass: white;
            --color-outline: transparent;
            --color-canvas-bg: rgb(204, 204, 204);
            --color-bg: var(--color-darkest);

            * {
                border-radius: 8px !important;
                font-family: Arial !important;
                font-size: small;
            }
        }

        [data-theme=ARCADE] {
            --color-outline: hsla(0, 0%, 100%, 0.1);
            --color-mid-hover: hsl(0, 0%, 13%);
            --color-hover: hsl(0, 0%, 13%);
            --color-mid: hsl(0, 0%, 0%);
            --color-input-bg: hsl(0, 0%, 0%);
            --color-darkest: hsl(0, 0%, 0%);
            --color-canvas-bg: var(--color-bg);
            --color-text-dark: var(--color-text-light);
            --frosted-glass: linear-gradient(45deg, hsla(0deg, 0%, 4%, 96.86%), hsla(0deg, 0%, 0%, 90.98%));
            --color-header: var(--frosted-glass);
            --outline: 2px solid var(--color-outline);
            --color-accent: hsl(125, 100%, 64%);
            --color-muted: hsla(125, 100%, 64%, 0.649);
            --color-bg: var(--color-darkest);

            * {
                border-radius: 0 !important;
                font-family: 'Dogica Pixel' !important;
                font-size: x-small;
                line-height: 1.2;
            }
        }

        body {
            background: var(--color-bg, var(--color-darkest));
            color: var(--color-text-light);
            font-family: sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100dvw;
            min-height: 100dvh;
            box-sizing: border-box;
            justify-content: center;
            user-select: none;
            gap: 10px;
        }

        * {
            margin: 0;
        }

        .container {
            display: flex;
            flex-direction: column;
            gap: 8px;
            background: linear-gradient(135deg, #ffffff08, #ffffff04);
            backdrop-filter: blur(10px);
            padding: 10px;
            border-radius: 22px;
            box-shadow: var(--shadow);
            border: var(--outline);
            align-items: center;
        }

        .color {
            display: inline-block;
            width: 30px;
            height: 30px;
            border-radius: 12px;
            border: var(--outline);
            cursor: pointer;
            transition: var(--smooth-transition);
            box-shadow: var(--shadow);
        }
        .color:hover {
            scale: var(--hover-scale);
        }
        .color.selected {
            border: 2px white solid;
        }

        #canvas {
            border: var(--outline);
            cursor: crosshair;
        }

        .onlineOnly,
        .offlineOnly {
            display: none;
        }

        .onlineOnly.visible,
        .offlineOnly.visible {
            display: flex;
            flex-direction: column;
        }

        button {
            box-shadow: var(--shadow);
            border-radius: 12px;
            transition: var(--smooth-transition);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-align: center;
            padding: 10px 12px;
            background-color: var(--color-accent);
            color: white;
            border: var(--outline);

            svg {
                width: 1.5rem;
            }
        }

        button:hover {
            scale: var(--hover-scale);
        }

        .status {
            display: flex;
            align-items: center;
            gap: 4px;
            color: #e03b49;

            svg {
                width: 24px;
            }
        }
        .status.online {
            color: #3be072 !important;
        }
    </style>
</head>

<body id="main">
    <img src="/logo.png" style="width: 50px;">
    <h1 style="color: var(--color-muted)">Pixels Place</h1>

    <div class="container">
        <p id="status"></p>
        <div class="offlineOnly">
            <h2>Sem conexão com a internet! ;-;</h2>
            <span>Você voltou pra idade da pedra? A mãe desligou o Wi-Fi? Roubaram o fio da sua casa?</span>
            <span>Bom, não importa o motivo</span>
            <span>Aqui vai um joguinho pra você se divertir por enquanto</span>
            <span style="opacity: 75%">E relaxa, vamos avisar se sua internet voltar ;)</span>
        </div>
        <div class="onlineOnly">
            <h2>Conectado à internet! :D</h2>
            <span>Não se preocupe, você só para de jogar quando quiser.</span>
        </div>
    </div>

    <div class="container" id="gameContainer">
        <p id="hurryMessage"></p>
        <p id="hurryTimer"></p>
        <div id="palette">
            <div class="color" style="background: red;" data-color="red"></div>
            <div class="color" style="background: blue;" data-color="blue"></div>
            <div class="color" style="background: yellow;" data-color="yellow"></div>
            <div class="color" style="background: green;" data-color="green"></div>
            <div class="color" style="background: white;" data-color="white"></div>
            <div class="color" style="background: black;" data-color="black"></div>
        </div>
        <canvas id="canvas" width="336" height="336"></canvas>
    </div>

    <script>

        // Parte visual
        if (localStorage.getItem('theme')) document.getElementById("main").dataset.theme = localStorage.getItem('theme');

        // Parte funcional

        // Monitora status da conexão
        function updateStatus() {
            const status = document.getElementById('status');
            if (navigator.onLine) {
                status.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"> <path d="M16 4h6v16h-6V4ZM2 14h6v6H2v-6Zm13-4H9v10h6V10Z"/> </svg> Online';
                status.className = 'status online';
                document.querySelectorAll('.onlineOnly').forEach(element => { element.classList.add('visible') });
                document.querySelectorAll('.offlineOnly').forEach(element => { element.classList.remove('visible') });
            } else {
                status.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24"> <path d="M4 2H2v2h2v2H2v2h2V6h2v2h2V6H6V4h2V2H6v2H4V2Zm12 2v16h6V4h-6Zm2 2h2v12h-2V6Zm-9 4v10h6V10H9Zm2 8v-6h2v6h-2Zm-3-4v6H2v-6h6Zm-2 4v-2H4v2h2Z"/> </svg> Offline';
                status.className = 'status';
                document.querySelectorAll('.onlineOnly').forEach(element => { element.classList.remove('visible') });
                document.querySelectorAll('.offlineOnly').forEach(element => { element.classList.add('visible') });
            }
        }

        // Verifica status inicial
        updateStatus();

        // Monitora mudanças na conexão
        window.addEventListener('online', updateStatus);
        window.addEventListener('offline', updateStatus);

        // Auto-reload quando voltar online
        window.addEventListener('online', function () {
            setTimeout(() => {
                if (confirm('Conexão restaurada! Deseja recarregar a página?')) {
                    window.location.reload();
                }
            }, 1000);
        });

        // === DESENHOS FÁCEIS (7 desenhos) ===
        // Coração simples
        const heart = [
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000011001100000",
            "0000122112210000",
            "0001202222221000",
            "0001222222221000",
            "0001222222221000",
            "0000122222210000",
            "0000012222100000",
            "0000001221000000",
            "0000000110000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Sol
        const sun = [
            "0000000000000000",
            "0000000220000000",
            "0020002222000200",
            "0002222222222000",
            "0002225555222000",
            "0002255555522000",
            "0022555555552200",
            "0221111111111220",
            "0222511155111220",
            "0022555555552200",
            "0002255555522000",
            "0002225555222000",
            "0002222222222000",
            "0020002222000200",
            "0000000220000000",
            "0000000000000000"
        ];
        // Estrela
        const star = [
            "0000000000000000",
            "0000000000000000",
            "0000000550000000",
            "0000000550000000",
            "0000005555000000",
            "0000055555500000",
            "0055551551555500",
            "0005551551555000",
            "0000055555500000",
            "0000055555500000",
            "0000555005550000",
            "0000550000550000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Casa simples
        const house = [
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000006000000000",
            "0000026222200000",
            "0000222226620000",
            "0002222266662000",
            "0000666666660000",
            "0000666666660000",
            "0000666661160000",
            "0000666661160000",
            "0000666661160000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Árvore
        const tree = [
            "0000000000000000",
            "0000003330000000",
            "0000333333300000",
            "0003333333330000",
            "0003333333330000",
            "0000333333300000",
            "0000335353300000",
            "0000035553000000",
            "0000000500000000",
            "0000005550000000",
            "0000005550000000",
            "0000055555000000",
            "0000550005500000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Flor
        const flower = [
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000200000",
            "0000000022220000",
            "0000000222222000",
            "0000000222220000",
            "0000000222220000",
            "0000330322200000",
            "0000333300000000",
            "0000333000000000",
            "0003300000000000",
            "0033000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Maçã
        const apple = [
            "0000000000000000",
            "0000000000000000",
            "0000003000000000",
            "0000033300000000",
            "0000222200000000",
            "0002222222000000",
            "0022222222200000",
            "0222222222220000",
            "0222222222220000",
            "0222222222220000",
            "0222222222220000",
            "0022222222200000",
            "0002222222000000",
            "0000222200000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // === DESENHOS MÉDIOS (5 desenhos) ===
        // Gato
        const cat = [
            "0000000000000000",
            "0001000000100000",
            "0001100001100000",
            "0001111111100000",
            "0011111111110000",
            "0111155155511000",
            "0111111111111000",
            "0111111111111000",
            "0111151115111000",
            "0111111111111000",
            "0111111111111000",
            "0011111111110000",
            "0001111111100000",
            "0000111111000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Peixe
        const spaceship = [
            "0000000000000000",
            "0000000000000000",
            "0011100000000000",
            "0111111000000000",
            "0444444400000000",
            "0444114411000000",
            "0444444411110000",
            "0444444411111000",
            "0444444411111000",
            "0444444411110000",
            "0444114411000000",
            "0444444400000000",
            "0111111000000000",
            "0011100000000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Borboleta
        const butterfly = [
            "0000000000000000",
            "0000000000000000",
            "0022000000220000",
            "0222200002220000",
            "0222220022220000",
            "0022222222220000",
            "0002222222200000",
            "0001111111100000",
            "0001111111100000",
            "0002222222200000",
            "0022222222220000",
            "0222220022220000",
            "0222200002220000",
            "0022000000220000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Foguete
        const rocket = [
            "0000000000000000",
            "0000001000000000",
            "0000011100000000",
            "0000111110000000",
            "0001111111000000",
            "0001111111000000",
            "0001151511000000",
            "0001111111000000",
            "0001111111000000",
            "0001111111000000",
            "0001111111000000",
            "0015111115000000",
            "0055111115500000",
            "0055000005500000",
            "0050000000500000",
            "0000000000000000"
        ];
        // Carro
        const car = [
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0011111111100000",
            "0111111111110000",
            "0111441144110000",
            "0111111111110000",
            "0111111111110000",
            "0111111111110000",
            "0111111111110000",
            "0511111111115000",
            "0055555555550000",
            "0000000000000000",
            "0000000000000000"
        ];
        // === DESENHOS DIFÍCEIS (3 desenhos) ===
        // Caveira
        const skull = [
            "0000000000000000",
            "0000000000000000",
            "0000011111100000",
            "0000166666610000",
            "0001666666661000",
            "0001666666661000",
            "0001611661161000",
            "0001611661161000",
            "0001666116661000",
            "0000166666610000",
            "0000161661610000",
            "0000010110100000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000",
            "0000000000000000"
        ];
        // Robô
        const robot = [
            "0000000000000000",
            "0000555555000000",
            "0005555555500000",
            "0055555555550000",
            "0555151515555000",
            "0555555555555000",
            "0555111111555000",
            "0555555555555000",
            "0555555555555000",
            "0555555555555000",
            "0555555555555000",
            "0555222222555000",
            "0555555555555000",
            "0055555555550000",
            "0005555555500000",
            "0000555555000000"
        ];
        // Dragão
        const dragon = [
            "0000000000000000",
            "0000000011000000",
            "0000001111100000",
            "0000011111110000",
            "0000111111111000",
            "0001111111111100",
            "0011111151111110",
            "0111111111111111",
            "0111111111111111",
            "0111111111111110",
            "0111111111111100",
            "0111111111111000",
            "0111111111110000",
            "0111111111100000",
            "0111111111000000",
            "0000000000000000"
        ];
        // Array com todos os desenhos organizados por dificuldade
        const allDrawings = {
            facil: [
                { name: "Coração", drawing: heart },
                { name: "Sol", drawing: sun },
                { name: "Estrela", drawing: star },
                { name: "Casa", drawing: house },
                { name: "Árvore", drawing: tree },
                { name: "Flor", drawing: flower },
                { name: "Maçã", drawing: apple }
            ],
            medio: [
                { name: "Gato", drawing: cat },
                { name: "Nave espacial", drawing: spaceship },
                { name: "Borboleta", drawing: butterfly },
                { name: "Foguete", drawing: rocket },
                { name: "Carro", drawing: car }
            ],
            dificil: [
                { name: "Caveira", drawing: skull },
                { name: "Robô", drawing: robot },
                { name: "Dragão", drawing: dragon }
            ]
        };
        let drawings = allDrawings;

        const maxTime = 30; // segundos pra desenhar cada
        let remainingTime = maxTime;

        // Desenho predefinido (16x16 matriz)
        let drawing;
        let hasTried = false;

        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");
        let currentColor = "red";
        let isDrawing = false;
        const pixelSize = 21;
        const defaultColors = ["transparent", "rgba(0,0,0,0.5)", "rgba(255,0,0,0.5)", "rgba(0,255,0,0.5)", "rgba(0,0,255,0.5)", "rgba(255,255,0,0.5)", "rgba(255,255,255,0.5)"];

        function sortearDesenho() {
            // Verifica se ainda há desenhos
            const dificuldadesDisponiveis = Object.keys(drawings).filter(diff => drawings[diff].length > 0);

            if (dificuldadesDisponiveis.length === 0) {
                document.getElementById('gameContainer').innerHTML = `
                    Você concluiu todos os desenhos!
                    <button onClick="location.reload()"><svg fill="none" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"> <path d="M16 2h-2v2h2v2H4v2H2v5h2V8h12v2h-2v2h2v-2h2V8h2V6h-2V4h-2V2zM6 20h2v2h2v-2H8v-2h12v-2h2v-5h-2v5H8v-2h2v-2H8v2H6v2H4v2h2v2z" fill="currentColor"/> </svg> Recarregar página</button>
                `;
                clearInterval(intervalTimer);
                clearInterval(intervalReset);
                return;
            }

            // Sorteia dificuldade
            const diffIndex = Math.floor(Math.random() * dificuldadesDisponiveis.length);
            const dificuldade = dificuldadesDisponiveis[diffIndex];

            // Sorteia desenho dentro da dificuldade
            const desenhoIndex = Math.floor(Math.random() * drawings[dificuldade].length);
            const selecionado = drawings[dificuldade][desenhoIndex];

            // Remove desenho sorteado da lista
            if (hasTried == true) {
                drawings[dificuldade].splice(desenhoIndex, 1);
                hasTried = false;
            };

            // Atualiza mensagem
            document.getElementById('hurryMessage').innerHTML =
                `Rápido! Desenhe ${selecionado.name} (nível ${dificuldade})`;
            document.getElementById('hurryTimer').innerHTML = `${maxTime} segundos restantes`;

            // Atualiza o desenho atual
            drawing = selecionado.drawing;

            // Redesenha canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBackground();
            drawGrid();
        }

        // Contador de tempo
        let intervalTimer = setInterval(() => {
            remainingTime -= 1;
            document.getElementById('hurryTimer').innerHTML = `${remainingTime} segundos restantes`;
        }, 1000);

        let intervalReset = setInterval(() => {
            remainingTime = maxTime;
            sortearDesenho();
        }, (maxTime * 1000) + 1000);

        // Primeira chamada
        sortearDesenho();

        // Desenha o fundo baseado no desenho predefinido
        function drawBackground() {
            drawing.forEach((row, y) => {
                row.split("").forEach((cell, x) => {
                    ctx.fillStyle = defaultColors[parseInt(cell)];
                    ctx.fillRect(x * pixelSize, y * pixelSize, pixelSize, pixelSize);
                });
            });
        }

        // Desenha a grade
        function drawGrid() {
            ctx.strokeStyle = "#66666666";
            ctx.lineWidth = 1;
            for (let i = 0; i <= 16; i++) {
                ctx.beginPath();
                ctx.moveTo(i * pixelSize, 0);
                ctx.lineTo(i * pixelSize, 16 * pixelSize);
                ctx.stroke();

                ctx.beginPath();
                ctx.moveTo(0, i * pixelSize);
                ctx.lineTo(16 * pixelSize, i * pixelSize);
                ctx.stroke();
            }
        }

        // Função para pintar um pixel
        function paintPixel(x, y) {
            const pixelX = Math.floor(x / pixelSize);
            const pixelY = Math.floor(y / pixelSize);
            if (pixelX >= 0 && pixelX < 16 && pixelY >= 0 && pixelY < 16) {
                ctx.fillStyle = currentColor;
                ctx.fillRect(pixelX * pixelSize, pixelY * pixelSize, pixelSize, pixelSize);
            }
            hasTried = true;
        }

        // Obtém coordenadas do mouse relativas ao canvas
        function getMousePos(e) {
            const rect = canvas.getBoundingClientRect();
            return {
                x: e.clientX - rect.left,
                y: e.clientY - rect.top
            };
        }

        // Inicializa o canvas
        drawBackground();
        drawGrid();

        // Seleção de cor
        document.querySelectorAll(".color").forEach(c => {
            c.addEventListener("click", () => {
                currentColor = c.dataset.color;
                document.querySelectorAll('.selected').forEach(element => element.classList.remove('selected'));
                c.classList.add('selected');
            });
        });

        // Mouse events
        canvas.addEventListener("mousedown", (e) => {
            isDrawing = true;
            const pos = getMousePos(e);
            paintPixel(pos.x, pos.y);
        });

        canvas.addEventListener("mousemove", (e) => {
            if (isDrawing) {
                const pos = getMousePos(e);
                paintPixel(pos.x, pos.y);
            }
        });

        canvas.addEventListener("mouseup", () => {
            isDrawing = false;
        });

        canvas.addEventListener("mouseleave", () => {
            isDrawing = false;
        });

        // Touch events para dispositivos móveis
        canvas.addEventListener("touchstart", (e) => {
            e.preventDefault();
            isDrawing = true;
            const touch = e.touches[0];
            const pos = getMousePos(touch);
            paintPixel(pos.x, pos.y);
        });

        canvas.addEventListener("touchmove", (e) => {
            e.preventDefault();
            if (isDrawing) {
                const touch = e.touches[0];
                const pos = getMousePos(touch);
                paintPixel(pos.x, pos.y);
            }
        });

        canvas.addEventListener("touchend", (e) => {
            e.preventDefault();
            isDrawing = false;
        });
    </script>
</body>

</html>